<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Live Accelerometer Data Graph</title>
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
</head>
<body>
<h1>Live Accelerometer Data Graph</h1>
<button onclick="requestMotionPermissions()">Enable Motion Data</button>
<canvas id="accChart"></canvas>

<script>
// Prepare the chart data structure
var data = {
    labels: [],
    datasets: [
        {
            label: 'X-axis',
            borderColor: 'rgb(255, 99, 132)',
            backgroundColor: 'rgba(255, 99, 132, 0.5)',
            data: []
        },
        {
            label: 'Y-axis',
            borderColor: 'rgb(54, 162, 235)',
            backgroundColor: 'rgba(54, 162, 235, 0.5)',
            data: []
        },
        {
            label: 'Z-axis',
            borderColor: 'rgb(75, 192, 192)',
            backgroundColor: 'rgba(75, 192, 192, 0.5)',
            data: []
        }
    ]
};

// Setup options
var config = {
    type: 'line',
    data: data,
    options: {
        scales: {
            x: {
                type: 'linear',
                beginAtZero: true
            }
        }
    }
};

// Create the chart
var accChart = new Chart(
    document.getElementById('accChart').getContext('2d'),
    config
);

// Function to update chart
function addData(chart, label, dataX, dataY, dataZ) {
    chart.data.labels.push(label);
    chart.data.datasets[0].data.push(dataX);
    chart.data.datasets[1].data.push(dataY);
    chart.data.datasets[2].data.push(dataZ);
    chart.update();
}

function motionHandler(event) {
    var acc = event.acceleration;
    if (acc) {
        addData(accChart, event.timeStamp, acc.x, acc.y, acc.z);
    }
}

function requestMotionPermissions() {
    if (typeof DeviceMotionEvent.requestPermission === 'function') {
        DeviceMotionEvent.requestPermission().then(permissionState => {
            if (permissionState === 'granted') {
                window.addEventListener('devicemotion', motionHandler, false);
            } else {
                console.log("Permission denied.");
            }
        }).catch(console.error);
    } else {
        window.addEventListener('devicemotion', motionHandler, false);
    }
}

// Check if DeviceMotionEvent is supported
if (!('DeviceMotionEvent' in window)) {
    console.log("DeviceMotionEvent is not supported on this device.");
}
</script>

</body>
</html>
